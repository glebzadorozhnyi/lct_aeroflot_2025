<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü™õ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        input[type="file"] {
            margin-bottom: 20px;
        }
        img {
            max-width: 80%;
            border: 2px solid #ccc;
            border-radius: 8px;
            margin-top: 20px;
        }


</style>

    </style>
</head>
<body>
    <h1>–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –¥–µ—Ç–µ–∫—Ç–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</h1>
    <label for="fileInput" style="cursor: pointer; background-color: #333333; color: white; padding: 8px 16px; border-radius: 4px;">
        –í—ã–±—Ä–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    </label>
    <input type="file" id="fileInput" accept="image/*" style="display: none;">


    <div style="display: flex; gap: 20px; max-width: 100%; align-items: flex-start;">
        <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–µ–≤–∞ -->
        <img id="resultImg" style="
            max-width: 60vw;
            max-height: 80vh;
            width: auto;
            height: auto;
            border: 1px solid #ccc;
            display: block; /* –≤–∞–∂–Ω–æ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è */
        ">

        <!-- Listbox —Å–ø—Ä–∞–≤–∞ -->
        <div style="
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            width: 200px;
            margin-top: 30px;  /* —Ä—É—á–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –≤–Ω–∏–∑ */
        ">
            <ul id="listBox" style="list-style: none; padding: 0; margin: 0;"></ul>
        </div>



    </div>
    <div>
        <button id="showAeroToolsTable">–ü–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã</button>
        <button id="resetBtn">–°–±—Ä–æ—Å–∏—Ç—å</button>
        <a href="/get_json_report">–õ–∏–Ω–∫ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ json</a>
        <table>
            <thead><tr><th>–ò–º—è</th><th>–¢–∏–ø</th><th>–°—Ç–∞—Ç—É—Å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead>
            <tbody id="toolsBody">
            </tbody>
        </table>
    </div>
    <script type="module" src="/static/main.js"></script>
    <script>
        const input = document.getElementById('fileInput');
        const resultImg = document.getElementById('resultImg');
        const listBox = document.getElementById('listBox');

        input.addEventListener('change', async () => {
            const file = input.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);

            const response = await fetch("/process-image", { method: "POST", body: formData });
            const data = await response.json();

            // –û–±–Ω–æ–≤–ª—è–µ–º listbox
            listBox.innerHTML = "";
            data.classes.forEach(class_name => {
                const li = document.createElement("li");
                li.textContent = class_name;
                listBox.appendChild(li);
            });

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const byteArray = new Uint8Array(data.image.match(/.{1,2}/g).map(byte => parseInt(byte, 16)));
            const blob = new Blob([byteArray], { type: "image/jpeg" });
            resultImg.src = URL.createObjectURL(blob);
        });
</script>
</body>
</html>
